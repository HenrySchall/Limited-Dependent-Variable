sum

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         age |      3,206    66.91391    3.675794         52         86
        hisp |      3,206    .0726762    .2596448          0          1
    educyear |      3,206    11.89863    3.304611          0         17
     married |      3,206    .7330006     .442461          0          1
      retire |      3,206    .6247661    .4842588          0          1
-------------+---------------------------------------------------------
    hhincome |      3,206    45.26391    64.33936          0   1312.124
         ins |      3,206    .3870867    .4871597          0          1
    hstatusg |      3,206    .7046163    .4562862          0          1

sort age
by age: sum ins

--------------------------------------------------------------------------------------
-> age = 52

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          4           0           0          0          0

--------------------------------------------------------------------------------------
-> age = 53

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          5          .4    .5477226          0          1

--------------------------------------------------------------------------------------
-> age = 54

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          2           0           0          0          0

--------------------------------------------------------------------------------------
-> age = 55

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          2          .5    .7071068          0          1

--------------------------------------------------------------------------------------
-> age = 56

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          7    .2857143      .48795          0          1

--------------------------------------------------------------------------------------
-> age = 57

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          8        .125    .3535534          0          1

--------------------------------------------------------------------------------------
-> age = 58

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         34    .4117647    .4995542          0          1

--------------------------------------------------------------------------------------
-> age = 59

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         62    .2258065    .4215255          0          1

--------------------------------------------------------------------------------------
-> age = 60

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         72    .2638889    .4438327          0          1

--------------------------------------------------------------------------------------
-> age = 61

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         51    .3137255    .4686233          0          1

--------------------------------------------------------------------------------------
-> age = 62

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         51    .2941176     .460179          0          1

--------------------------------------------------------------------------------------
-> age = 63

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         67    .3731343    .4872875          0          1

--------------------------------------------------------------------------------------
-> age = 64

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         74    .2567568     .439826          0          1

--------------------------------------------------------------------------------------
-> age = 65

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        524    .4312977    .4957308          0          1

--------------------------------------------------------------------------------------
-> age = 66

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        470    .4255319    .4949502          0          1

--------------------------------------------------------------------------------------
-> age = 67

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        488        .375    .4846197          0          1

--------------------------------------------------------------------------------------
-> age = 68

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        477    .3836478    .4867843          0          1

--------------------------------------------------------------------------------------
-> age = 69

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        286    .4090909    .4925279          0          1

--------------------------------------------------------------------------------------
-> age = 70

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        133     .406015    .4929441          0          1

--------------------------------------------------------------------------------------
-> age = 71

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |        100         .46    .5009083          0          1

--------------------------------------------------------------------------------------
-> age = 72

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         91    .3626374    .4834249          0          1

--------------------------------------------------------------------------------------
-> age = 73

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         67    .4179104    .4969377          0          1

--------------------------------------------------------------------------------------
-> age = 74

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         36    .3611111    .4871361          0          1

--------------------------------------------------------------------------------------
-> age = 75

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         29    .3448276    .4837253          0          1

--------------------------------------------------------------------------------------
-> age = 76

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         19    .3157895    .4775669          0          1

--------------------------------------------------------------------------------------
-> age = 77

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         11    .1818182    .4045199          0          1

--------------------------------------------------------------------------------------
-> age = 78

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          8         .25      .46291          0          1

--------------------------------------------------------------------------------------
-> age = 79

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |         11    .3636364     .504525          0          1

--------------------------------------------------------------------------------------
-> age = 80

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          4         .25          .5          0          1

--------------------------------------------------------------------------------------
-> age = 81

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          6    .6666667    .5163978          0          1

--------------------------------------------------------------------------------------
-> age = 82

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          5          .2    .4472136          0          1

--------------------------------------------------------------------------------------
-> age = 83

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          1           0           .          0          0

--------------------------------------------------------------------------------------
-> age = 86

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |          1           0           .          0          0


pwcorr ins age hisp educyear married retire hhincome hstatusg, star(.1)

             |      ins      age     hisp educyear  married   retire hhincome
-------------+---------------------------------------------------------------
         ins |   1.0000 
         age |   0.0312*  1.0000 
        hisp |  -0.1361* -0.0006   1.0000 
    educyear |   0.2306*  0.0399* -0.3281*  1.0000 
     married |   0.1467*  0.1576* -0.0266   0.0749*  1.0000 
      retire |   0.0802*  0.3116* -0.0659*  0.1351*  0.1220*  1.0000 
    hhincome |   0.1488*  0.0652* -0.1053*  0.2904*  0.2085* -0.0120   1.0000 
    hstatusg |   0.1398*  0.1967* -0.1163*  0.3098*  0.0961*  0.1280*  0.1551*

             | hstatusg
-------------+---------
    hstatusg |   1.0000 

* (*) = Correlação é significativa ao nível de significancia definido
* Em relação a variável dependente todas as variáveis explicativas são significativas
* Age e retire tem correlação positiva e relativamente fraca
* O resto da matriz mostra uma relação de multicolinealidade

* Nesse caso podemos os modelos MPL,LOGIT e PROBIT

reg ins age hisp educyear married retire hhincome hstatusg, robust

Linear regression                               Number of obs     =      3,206
                                                F(7, 3198)        =      58.98
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0826
                                                Root MSE          =     .46711

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0028955   .0023254    -1.25   0.213    -.0074549    .0016638
        hisp |  -.1210059   .0269459    -4.49   0.000    -.1738389    -.068173
    educyear |   .0233686   .0027081     8.63   0.000     .0180589    .0286784
     married |   .1234699   .0186521     6.62   0.000     .0868987    .1600411
      retire |   .0408508   .0182217     2.24   0.025     .0051234    .0765782
    hhincome |   .0004921   .0001874     2.63   0.009     .0001247    .0008595
    hstatusg |   .0655583   .0190126     3.45   0.001     .0282801    .1028365
       _cons |   .1270857   .1538816     0.83   0.409    -.1746309    .4288023
------------------------------------------------------------------------------

estimates store mpl

* O modelo é significativo do ponto de global (estatístico) 

logit ins age hisp educyear married retire hhincome hstatusg, robust

Iteration 0:   log pseudolikelihood = -2139.7712  
Iteration 1:   log pseudolikelihood = -1996.7434  
Iteration 2:   log pseudolikelihood = -1994.8864  
Iteration 3:   log pseudolikelihood = -1994.8784  
Iteration 4:   log pseudolikelihood = -1994.8784  

Logistic regression                                     Number of obs =  3,206
                                                        Wald chi2(7)  = 256.49
                                                        Prob > chi2   = 0.0000
Log pseudolikelihood = -1994.8784                       Pseudo R2     = 0.0677

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0145955   .0110189    -1.32   0.185    -.0361921     .007001
        hisp |  -.8103059   .1936793    -4.18   0.000     -1.18991   -.4307016
    educyear |   .1142626   .0143616     7.96   0.000     .0861143    .1424108
     married |    .578636   .0941579     6.15   0.000       .39409    .7631821
      retire |   .1969297   .0849524     2.32   0.020     .0304261    .3634332
    hhincome |   .0023036   .0011485     2.01   0.045     .0000526    .0045546
    hstatusg |   .3122654   .0918378     3.40   0.001     .1322667    .4922641
       _cons |  -1.715578   .7279873    -2.36   0.018    -3.142407   -.2887495
------------------------------------------------------------------------------

estimates store logit

* O modelo é significativo do ponto de global (estatístico) 

probit ins age hisp educyear married retire hhincome hstatusg, robust

Iteration 0:   log pseudolikelihood = -2139.7712  
Iteration 1:   log pseudolikelihood = -1994.4552  
Iteration 2:   log pseudolikelihood =  -1993.624  
Iteration 3:   log pseudolikelihood = -1993.6237  
Iteration 4:   log pseudolikelihood = -1993.6237  

Probit regression                                       Number of obs =  3,206
                                                        Wald chi2(7)  = 276.45
                                                        Prob > chi2   = 0.0000
Log pseudolikelihood = -1993.6237                       Pseudo R2     = 0.0683

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0088696   .0067402    -1.32   0.188    -.0220801    .0043409
        hisp |  -.4731099   .1086273    -4.36   0.000    -.6860156   -.2602043
    educyear |   .0707477   .0084932     8.33   0.000     .0541013    .0873942
     married |    .362329   .0560611     6.46   0.000     .2524514    .4722067
      retire |   .1183567   .0514939     2.30   0.022     .0174304    .2192829
    hhincome |    .001233   .0005574     2.21   0.027     .0001405    .0023256
    hstatusg |   .1977357    .055397     3.57   0.000     .0891595    .3063118
       _cons |  -1.069319   .4460128    -2.40   0.017    -1.943488   -.1951505
------------------------------------------------------------------------------

estimates store probit

* O modelo é significativo do ponto de global (estatístico) 

estimates table mpl logit probit, b p

-----------------------------------------------------
    Variable |    mpl         logit        probit    
-------------+---------------------------------------
_            |
         age | -.00289555                            
             |     0.2132                            
        hisp | -.12100593 --->                            
             |     0.0000 ---> P-valor                       
    educyear |  .02336863                            
             |     0.0000                            
     married |  .12346988                            
             |     0.0000                            
      retire |  .04085082                            
             |     0.0250                            
    hhincome |  .00049209                            
             |     0.0087                            
    hstatusg |  .06555834                            
             |     0.0006                            
       _cons |   .1270857                            
             |     0.4089                            
-------------+---------------------------------------
ins          |
         age |              -.01459553   -.00886962  
             |                  0.1853       0.1882  
        hisp |              -.81030593   -.47310993  
             |                  0.0000       0.0000  
    educyear |               .11426256    .07074775  
             |                  0.0000       0.0000  
     married |               .57863605    .36232905  
             |                  0.0000       0.0000  
      retire |               .19692966    .11835665  
             |                  0.0204       0.0215  
    hhincome |                .0023036    .00123304  
             |                  0.0449       0.0270  
    hstatusg |               .31226537    .19773566  
             |                  0.0007       0.0004  
       _cons |              -1.7155784   -1.0693194  
             |                  0.0184       0.0165  
-----------------------------------------------------
                                          Legend: b/p

* Posso analisar os valores de MPL quantativamente p
* Age não é sifnificativa a 10% nos três modelos (p-valor maior que o nível de significância, não rejeita H0)

* Conclusao controlado pelos outros fatores à variável age não afeta a probabilidade do indivíduo possuir o plano de saúde privado

* variável hisp é significativa nos três casos (exemplo)

*** EXEMPLO ***

* Anos de estudos (MPL) = a cada ano de estudoa mais a probabilidade de possuir plano de saude cresce .02336863. Para saber em logit e probit eu tenho que tomar a derivada para encontrar a função de densidade acumulada, sendo que ela irá ser para um ponto específico ou posso calcular o efeito parcial médio.

------------------------------------------------------------------------------

Linear regression                               Number of obs     =      3,206
                                                F(7, 3198)        =      58.98
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0826
                                                Root MSE          =     .46711

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0028955   .0023254    -1.25   0.213    -.0074549    .0016638
        hisp |  -.1210059   .0269459    -4.49   0.000    -.1738389    -.068173
    educyear |   .0233686   .0027081     8.63   0.000     .0180589    .0286784
     married |   .1234699   .0186521     6.62   0.000     .0868987    .1600411
      retire |   .0408508   .0182217     2.24   0.025     .0051234    .0765782
    hhincome |   .0004921   .0001874     2.63   0.009     .0001247    .0008595
    hstatusg |   .0655583   .0190126     3.45   0.001     .0282801    .1028365
       _cons |   .1270857   .1538816     0.83   0.409    -.1746309    .4288023
------------------------------------------------------------------------------

Probit regression                                       Number of obs =  3,206
                                                        Wald chi2(7)  = 276.45
                                                        Prob > chi2   = 0.0000
Log pseudolikelihood = -1993.6237                       Pseudo R2     = 0.0683

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0088696   .0067402    -1.32   0.188    -.0220801    .0043409
        hisp |  -.4731099   .1086273    -4.36   0.000    -.6860156   -.2602043
    educyear |   .0707477   .0084932     8.33   0.000     .0541013    .0873942
     married |    .362329   .0560611     6.46   0.000     .2524514    .4722067
      retire |   .1183567   .0514939     2.30   0.022     .0174304    .2192829
    hhincome |    .001233   .0005574     2.21   0.027     .0001405    .0023256
    hstatusg |   .1977357    .055397     3.57   0.000     .0891595    .3063118
       _cons |  -1.069319   .4460128    -2.40   0.017    -1.943488   -.1951505
------------------------------------------------------------------------------

Logistic regression                                     Number of obs =  3,206
                                                        Wald chi2(7)  = 256.49
                                                        Prob > chi2   = 0.0000
Log pseudolikelihood = -1994.8784                       Pseudo R2     = 0.0677

------------------------------------------------------------------------------
             |               Robust
         ins | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0145955   .0110189    -1.32   0.185    -.0361921     .007001
        hisp |  -.8103059   .1936793    -4.18   0.000     -1.18991   -.4307016
    educyear |   .1142626   .0143616     7.96   0.000     .0861143    .1424108
     married |    .578636   .0941579     6.15   0.000       .39409    .7631821
      retire |   .1969297   .0849524     2.32   0.020     .0304261    .3634332
    hhincome |   .0023036   .0011485     2.01   0.045     .0000526    .0045546
    hstatusg |   .3122654   .0918378     3.40   0.001     .1322667    .4922641
       _cons |  -1.715578   .7279873    -2.36   0.018    -3.142407   -.2887495
------------------------------------------------------------------------------


* O psdeudo r2 do modelo inrestrito (com todas as variáveis) em comparacao com o modelo restrito (só a constante), aumenta a probabilidade de retornar sua amostra em 0.0683 (probit) e 0.0677 (logit)
* Todavia essa comparação é insiginifcante (entre modelo linear (r2) para os modelos probit e logit (pseudo r2))

*** CALCULANDO EFEITO PARCIAL MÉDIO ***

* 1) logit

logit ins age hisp educyear married retire hhincome hstatusg, robust
margins, dydx(*)

Average marginal effects                                 Number of obs = 3,206
Model VCE: Robust

Expression: Pr(ins), predict()
dy/dx wrt:  age hisp educyear married retire hhincome hstatusg

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0031693   .0023904    -1.33   0.185    -.0078543    .0015158
        hisp |   -.175951   .0418131    -4.21   0.000    -.2579032   -.0939989
    educyear |   .0248111   .0030334     8.18   0.000     .0188658    .0307565
     married |   .1256459   .0201381     6.24   0.000      .086176    .1651158
      retire |   .0427616   .0183837     2.33   0.020     .0067303    .0787929
    hhincome |   .0005002    .000248     2.02   0.044     .0000141    .0009863
    hstatusg |   .0678058   .0198708     3.41   0.001     .0288597    .1067518


* 2) probit

probit ins age hisp educyear married retire hhincome hstatusg, robust
margins, dydx(*)


Average marginal effects                                 Number of obs = 3,206
Model VCE: Robust

Expression: Pr(ins), predict()
dy/dx wrt:  age hisp educyear married retire hhincome hstatusg

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0031459   .0023889    -1.32   0.188     -.007828    .0015363
        hisp |  -.1678014   .0382993    -4.38   0.000    -.2428666   -.0927362
    educyear |   .0250926   .0029312     8.56   0.000     .0193477    .0308376
     married |   .1285099   .0195699     6.57   0.000     .0901536    .1668662
      retire |   .0419784   .0182176     2.30   0.021     .0062725    .0776844
    hhincome |   .0004373   .0001969     2.22   0.026     .0000513    .0008233
    hstatusg |   .0701324   .0195655     3.58   0.000     .0317846    .1084801
------------------------------------------------------------------------------

*** Prever ***

predict p_mpl
(option xb assumed; fitted values)

predict p_logit
(option xb assumed; fitted values)

predict p_probit
(option xb assumed; fitted values)

sum ins p_mpl p_logit p_probit

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ins |      3,206    .3870867    .4871597          0          1
       p_mpl |      3,206    .3870867    .1400249  -.1557328   1.197223
     p_logit |      3,206    .3870867    .1400249  -.1557328   1.197223
    p_probit |      3,206    .3870867    .1400249  -.1557328   1.197223

scatter p_mpl age
